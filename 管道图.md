
## 管道图1

设计的管道图，为如下结构

```

     +—————————————————+             +————————————————————+             +——————————————————+
     |                 |    #1       |                    |             |                  |
———> | bestCharge()    |————————————>|  GetOrderList()    |————————————>|  loadAllItems()  |
     |                 |<————————————|                    |<————————————|                  |
     |                 |             |                    |             |                  |
     |                 |             +————————————————————+             +——————————————————+
     |                 | 
     |                 |
     |                 |             +————————————————————+             +——————————————————+
     |                 |    #3       |                    |             |                  |
     |                 |————————————>| GetBestPromotion() |————————————>|  loadAllItems()  |
     |                 |             |                    |<————————————|                  |
     |                 |             |                    |             |                  |
     |                 |             |                    |             +——————————————————+ 
     |                 |             |                    |             +——————————————————+ 
     |                 |             |                    |             |                  |
     |                 |             |                    |————————————>| loadPromotions() |
     |                 |             |                    |<————————————|                  |                  
     |                 |             |                    |             |                  |
     |                 |             |                    |             +——————————————————+
     |                 |             |                    |             +—————————————————-+
     |                 |             |                    |     #2      |                  |
     |                 |             |                    |————————————>| CalcPromotionChar|
     |                 |<————————————|                    |<————————————|ge()              |
     |                 |             |                    |             |                  | 
     |                 |             +————————————————————+             +——————————————————+
     |                 |             +————————————————————+            
     |                 |    #4       |                    |
     |                 |————————————>| PrintCheckout()    |
<————|                 |<————————————|                    |
     |                 |             |                    |   
     +—————————————————+             +————————————————————+
```

上述管道图对应的函数输入输出为：

```
#1 函数 GetOrderList()
输入：
Order: StringArray ["ITEM0001 x 1", "ITEM0013 x 2", "ITEM0022 x 1”]

输出：
OrderList: [
    {
        ItemId: String,
        count: Integer,
        charge: float : loadAllItems()
    },
   ...
]
=================================
#2 函数 CalcPromotionCharge()

输入：
OrderList: [
    {
        ItemId: String,
        count: Integer,
        charge: float,
    },
    ...
]: 

PromotionType: String 

输出：
Charge: Float

=================================
#3 函数 BestPromotion()

输入:
OrderList: [
    {
        ItemId: String,
        count: Integer,
        charge: float,
    },
    ...
]: GetOrderList()

PromotionCollection: StringArray [PromotionType: String,...]: loadPromotions()

Charge1: float : 6

Charge2: float : CalcPromotionCharge()

输出：

BestPromotion: {
    Type: String,
    Name: String,
    Charge: float,
}

==============================
#4 函数 PrintCheckout()

输入：
OrderList: [
    {
        ItemId: String
        count: Integer
        charge: float,
    },
   ...
]: GetOrderList( )
Promotion: String: BestPromotion( )

输出：
Checkout: String
```

## 管道图2

实际编程时候，为了避免 GetBestPromotion() 和 GetOrderList() 重复调用 loadAllItems() 函数

重构成了下面的结构：

```
     +—————————————————+             +————————————————————+             +——————————————————+
     |                 |             |                    |             |                  | 
————>|                 |————————————>|  GetAllItems()     |————————————>|  loadAllItems()  |
     |                 |<————————————|                    |<————————————|                  |
     |                 |             |                    |             |                  |
     |                 |             +————————————————————+             +——————————————————+
     |                 |             +————————————————————+
     |                 |             |                    |
     | bestCharge()    |————————————>|  GetOrderList()    |
     |                 |<————————————|                    |
     |                 |             |                    |
     |                 |             +————————————————————+
     |                 |
     |                 |             +————————————————————+             +——————————————————+
     |                 |             |                    |             |                  |
     |                 |————————————>| GetBestPromotion() |————————————>| loadPromotions() |
     |                 |<————————————|                    |<————————————|                  |
     |                 |             |                    |             |                  |
     |                 |             |                    |             +——————————————————+
     |                 |             |                    |             +——————————————————+
     |                 |             |                    |             |                  |
     |                 |             |                    |————————————>| CalcPromotionChar|
     |                 |<————————————|                    |<————————————|ge()              |
     |                 |             |                    |             |                  | 
     |                 |             +————————————————————+             +——————————————————+
     |                 |             +————————————————————+            
     |                 |             |                    |
     |                 |————————————>| PrintCheckout()    |
<————|                 |<————————————|                    |
     |                 |             |                    |   
     +—————————————————+             +————————————————————+  
```    
